<?xml version="1.0"?>
<!DOCTYPE workflow
[
	<!--
	PROGRAM
		Main workflow manager for Global Forecast System

	NOTES:
		This workflow was automatically generated at 2025-12-16 18:56:12.868687
	-->
	<!ENTITY PSLOT "C48_ATM">
	<!ENTITY ROTDIR "/scratch3/NCEPDEV/stmp/David.Huber/rt_cleanup/COMROOT/C48_ATM">
	<!ENTITY MAXTRIES "2">
]>

<workflow realtime="F" scheduler="slurm" cyclethrottle="3" taskthrottle="25">

	<log verbosity="10"><cyclestr>/scratch3/NCEPDEV/stmp/David.Huber/rt_cleanup/EXPDIR/C48_ATM/logs/@Y@m@d@H.log</cyclestr></log>

	<!-- Define the cycles -->
	<cycledef group="gfs">202103231200 202103231200 06:00:00</cycledef>

<task name="gfs_stage_ic" cycledefs="gfs" maxtries="&MAXTRIES;">

	<command>/scratch3/NCEPDEV/global/David.Huber/GW/develop/dev/job_cards/rocoto/stage_ic.sh</command>

	<jobname><cyclestr>C48_ATM_gfs_stage_ic_@H</cyclestr></jobname>
	<account>fv3-cpu</account>
	<queue>batch</queue>
	<partition>u1-service</partition>
	<walltime>00:15:00</walltime>
	<cores>1</cores>
	<memory>4096M</memory>
	<native>--export=NONE</native>

	<join><cyclestr>/scratch3/NCEPDEV/stmp/David.Huber/rt_cleanup/COMROOT/C48_ATM/logs/@Y@m@d@H/gfs_stage_ic.log</cyclestr></join>

	<envar><name>RUN_ENVIR</name><value>emc</value></envar>
	<envar><name>HOMEgfs</name><value>/scratch3/NCEPDEV/global/David.Huber/GW/develop</value></envar>
	<envar><name>EXPDIR</name><value>/scratch3/NCEPDEV/stmp/David.Huber/rt_cleanup/EXPDIR/C48_ATM</value></envar>
	<envar><name>NET</name><value>gfs</value></envar>
	<envar><name>RUN</name><value>gfs</value></envar>
	<envar><name>CDATE</name><value><cyclestr>@Y@m@d@H</cyclestr></value></envar>
	<envar><name>PDY</name><value><cyclestr>@Y@m@d</cyclestr></value></envar>
	<envar><name>cyc</name><value><cyclestr>@H</cyclestr></value></envar>
	<envar><name>COMROOT</name><value>/scratch3/NCEPDEV/stmp/David.Huber/rt_cleanup/COMROOT</value></envar>
	<envar><name>DATAROOT</name><value>/scratch4/NCEPDEV/stmp/David.Huber/RUNDIRS/C48_ATM/gfs.<cyclestr>@Y@m@d@H</cyclestr></value></envar>

</task>

<metatask name="gfs_fcst" mode="serial">

	<var name="seg">0</var>

	<task name="gfs_fcst_seg#seg#" cycledefs="gfs" maxtries="&MAXTRIES;">

		<command>/scratch3/NCEPDEV/global/David.Huber/GW/develop/dev/job_cards/rocoto/fcst.sh</command>

		<jobname><cyclestr>C48_ATM_gfs_fcst_seg#seg#_@H</cyclestr></jobname>
		<account>fv3-cpu</account>
		<queue>batch</queue>
		<partition>u1-compute</partition>
		<walltime>03:00:00</walltime>
		<cores>192</cores>
		<native>--exclusive</native>

		<join><cyclestr>/scratch3/NCEPDEV/stmp/David.Huber/rt_cleanup/COMROOT/C48_ATM/logs/@Y@m@d@H/gfs_fcst_seg#seg#.log</cyclestr></join>

		<envar><name>RUN_ENVIR</name><value>emc</value></envar>
		<envar><name>HOMEgfs</name><value>/scratch3/NCEPDEV/global/David.Huber/GW/develop</value></envar>
		<envar><name>EXPDIR</name><value>/scratch3/NCEPDEV/stmp/David.Huber/rt_cleanup/EXPDIR/C48_ATM</value></envar>
		<envar><name>NET</name><value>gfs</value></envar>
		<envar><name>RUN</name><value>gfs</value></envar>
		<envar><name>CDATE</name><value><cyclestr>@Y@m@d@H</cyclestr></value></envar>
		<envar><name>PDY</name><value><cyclestr>@Y@m@d</cyclestr></value></envar>
		<envar><name>cyc</name><value><cyclestr>@H</cyclestr></value></envar>
		<envar><name>COMROOT</name><value>/scratch3/NCEPDEV/stmp/David.Huber/rt_cleanup/COMROOT</value></envar>
		<envar><name>DATAROOT</name><value>/scratch4/NCEPDEV/stmp/David.Huber/RUNDIRS/C48_ATM/gfs.<cyclestr>@Y@m@d@H</cyclestr></value></envar>
		<envar><name>FCST_SEGMENT</name><value>#seg#</value></envar>

		<dependency>
			<and>
				<taskdep task="gfs_stage_ic"/>
			</and>
		</dependency>

	</task>

</metatask>

<metatask name="gfs_atmos_prod" mode="parallel">

	<var name="fhr_list">0,1,2 3,4,5 6,7,8 9,10,11 12,13,14 15,16,17 18,19,20 21,22,23 24,25,26 27,28,29 30,31,32 33,34,35 36,37,38 39,40,41 42,43,44 45,46,47 48,51,54 57,60,63 66,69,72 75,78,81 84,87,90 93,96,99 102,105,108 111,114 117,120</var>
	<var name="fhr_label">f000-f002 f003-f005 f006-f008 f009-f011 f012-f014 f015-f017 f018-f020 f021-f023 f024-f026 f027-f029 f030-f032 f033-f035 f036-f038 f039-f041 f042-f044 f045-f047 f048-f054 f057-f063 f066-f072 f075-f081 f084-f090 f093-f099 f102-f108 f111-f114 f117-f120</var>
	<var name="seg_dep">seg0 seg0 seg0 seg0 seg0 seg0 seg0 seg0 seg0 seg0 seg0 seg0 seg0 seg0 seg0 seg0 seg0 seg0 seg0 seg0 seg0 seg0 seg0 seg0 seg0</var>
	<var name="fhr3_last">002 005 008 011 014 017 020 023 026 029 032 035 038 041 044 047 054 063 072 081 090 099 108 114 120</var>
	<var name="fhr3_next">003 006 009 012 015 018 021 024 027 030 033 036 039 042 045 048 057 066 075 084 093 102 111 117 123</var>

	<task name="gfs_atmos_prod_#fhr_label#" cycledefs="gfs" maxtries="&MAXTRIES;">

		<command>/scratch3/NCEPDEV/global/David.Huber/GW/develop/dev/job_cards/rocoto/atmos_products.sh</command>

		<jobname><cyclestr>C48_ATM_gfs_atmos_prod_#fhr_label#_@H</cyclestr></jobname>
		<account>fv3-cpu</account>
		<queue>batch</queue>
		<partition>u1-compute</partition>
		<walltime>00:45:00</walltime>
		<cores>24</cores>
		<native>--exclusive</native>

		<join><cyclestr>/scratch3/NCEPDEV/stmp/David.Huber/rt_cleanup/COMROOT/C48_ATM/logs/@Y@m@d@H/gfs_atmos_prod_#fhr_label#.log</cyclestr></join>

		<envar><name>RUN_ENVIR</name><value>emc</value></envar>
		<envar><name>HOMEgfs</name><value>/scratch3/NCEPDEV/global/David.Huber/GW/develop</value></envar>
		<envar><name>EXPDIR</name><value>/scratch3/NCEPDEV/stmp/David.Huber/rt_cleanup/EXPDIR/C48_ATM</value></envar>
		<envar><name>NET</name><value>gfs</value></envar>
		<envar><name>RUN</name><value>gfs</value></envar>
		<envar><name>CDATE</name><value><cyclestr>@Y@m@d@H</cyclestr></value></envar>
		<envar><name>PDY</name><value><cyclestr>@Y@m@d</cyclestr></value></envar>
		<envar><name>cyc</name><value><cyclestr>@H</cyclestr></value></envar>
		<envar><name>COMROOT</name><value>/scratch3/NCEPDEV/stmp/David.Huber/rt_cleanup/COMROOT</value></envar>
		<envar><name>DATAROOT</name><value>/scratch4/NCEPDEV/stmp/David.Huber/RUNDIRS/C48_ATM/gfs.<cyclestr>@Y@m@d@H</cyclestr></value></envar>
		<envar><name>FHR_LIST</name><value>#fhr_list#</value></envar>
		<envar><name>COMPONENT</name><value>atmos</value></envar>

		<dependency>
			<or>
				<datadep age="120"><cyclestr>&ROTDIR;/gfs.@Y@m@d/@H//model/atmos/master/gfs.t@Hz.master.f#fhr3_last#.grib2</cyclestr></datadep>
				<metataskdep metatask="gfs_fcst"/>
			</or>
		</dependency>

	</task>

</metatask>

<task name="gfs_tracker" cycledefs="gfs" maxtries="&MAXTRIES;">

	<command>/scratch3/NCEPDEV/global/David.Huber/GW/develop/dev/job_cards/rocoto/tracker.sh</command>

	<jobname><cyclestr>C48_ATM_gfs_tracker_@H</cyclestr></jobname>
	<account>fv3-cpu</account>
	<queue>batch</queue>
	<partition>u1-compute</partition>
	<walltime>00:10:00</walltime>
	<cores>1</cores>
	<memory>6G</memory>
	<native>--export=NONE</native>

	<join><cyclestr>/scratch3/NCEPDEV/stmp/David.Huber/rt_cleanup/COMROOT/C48_ATM/logs/@Y@m@d@H/gfs_tracker.log</cyclestr></join>

	<envar><name>RUN_ENVIR</name><value>emc</value></envar>
	<envar><name>HOMEgfs</name><value>/scratch3/NCEPDEV/global/David.Huber/GW/develop</value></envar>
	<envar><name>EXPDIR</name><value>/scratch3/NCEPDEV/stmp/David.Huber/rt_cleanup/EXPDIR/C48_ATM</value></envar>
	<envar><name>NET</name><value>gfs</value></envar>
	<envar><name>RUN</name><value>gfs</value></envar>
	<envar><name>CDATE</name><value><cyclestr>@Y@m@d@H</cyclestr></value></envar>
	<envar><name>PDY</name><value><cyclestr>@Y@m@d</cyclestr></value></envar>
	<envar><name>cyc</name><value><cyclestr>@H</cyclestr></value></envar>
	<envar><name>COMROOT</name><value>/scratch3/NCEPDEV/stmp/David.Huber/rt_cleanup/COMROOT</value></envar>
	<envar><name>DATAROOT</name><value>/scratch4/NCEPDEV/stmp/David.Huber/RUNDIRS/C48_ATM/gfs.<cyclestr>@Y@m@d@H</cyclestr></value></envar>

	<dependency>
		<metataskdep metatask="gfs_atmos_prod"/>
	</dependency>

</task>

<task name="gfs_genesis" cycledefs="gfs" maxtries="&MAXTRIES;">

	<command>/scratch3/NCEPDEV/global/David.Huber/GW/develop/dev/job_cards/rocoto/genesis.sh</command>

	<jobname><cyclestr>C48_ATM_gfs_genesis_@H</cyclestr></jobname>
	<account>fv3-cpu</account>
	<queue>batch</queue>
	<partition>u1-compute</partition>
	<walltime>00:40:00</walltime>
	<cores>1</cores>
	<memory>20G</memory>
	<native>--export=NONE</native>

	<join><cyclestr>/scratch3/NCEPDEV/stmp/David.Huber/rt_cleanup/COMROOT/C48_ATM/logs/@Y@m@d@H/gfs_genesis.log</cyclestr></join>

	<envar><name>RUN_ENVIR</name><value>emc</value></envar>
	<envar><name>HOMEgfs</name><value>/scratch3/NCEPDEV/global/David.Huber/GW/develop</value></envar>
	<envar><name>EXPDIR</name><value>/scratch3/NCEPDEV/stmp/David.Huber/rt_cleanup/EXPDIR/C48_ATM</value></envar>
	<envar><name>NET</name><value>gfs</value></envar>
	<envar><name>RUN</name><value>gfs</value></envar>
	<envar><name>CDATE</name><value><cyclestr>@Y@m@d@H</cyclestr></value></envar>
	<envar><name>PDY</name><value><cyclestr>@Y@m@d</cyclestr></value></envar>
	<envar><name>cyc</name><value><cyclestr>@H</cyclestr></value></envar>
	<envar><name>COMROOT</name><value>/scratch3/NCEPDEV/stmp/David.Huber/rt_cleanup/COMROOT</value></envar>
	<envar><name>DATAROOT</name><value>/scratch4/NCEPDEV/stmp/David.Huber/RUNDIRS/C48_ATM/gfs.<cyclestr>@Y@m@d@H</cyclestr></value></envar>

	<dependency>
		<metataskdep metatask="gfs_atmos_prod"/>
	</dependency>

</task>

<metatask name="gfs_arch_tars" mode="parallel">

	<var name="tartype">gfsa gfsb gfs_flux gfs_netcdfb gfs_pgrb2b</var>

	<task name="gfs_arch_tar_#tartype#" cycledefs="gfs" maxtries="&MAXTRIES;">

		<command>/scratch3/NCEPDEV/global/David.Huber/GW/develop/dev/job_cards/rocoto/arch_tars.sh</command>

		<jobname><cyclestr>C48_ATM_gfs_arch_tar_#tartype#_@H</cyclestr></jobname>
		<account>fv3-cpu</account>
		<queue>batch</queue>
		<partition>u1-service</partition>
		<walltime>06:00:00</walltime>
		<cores>1</cores>
		<memory>4096M</memory>
		<native>--export=NONE</native>

		<join><cyclestr>/scratch3/NCEPDEV/stmp/David.Huber/rt_cleanup/COMROOT/C48_ATM/logs/@Y@m@d@H/gfs_arch_tar_#tartype#.log</cyclestr></join>

		<envar><name>RUN_ENVIR</name><value>emc</value></envar>
		<envar><name>HOMEgfs</name><value>/scratch3/NCEPDEV/global/David.Huber/GW/develop</value></envar>
		<envar><name>EXPDIR</name><value>/scratch3/NCEPDEV/stmp/David.Huber/rt_cleanup/EXPDIR/C48_ATM</value></envar>
		<envar><name>NET</name><value>gfs</value></envar>
		<envar><name>RUN</name><value>gfs</value></envar>
		<envar><name>CDATE</name><value><cyclestr>@Y@m@d@H</cyclestr></value></envar>
		<envar><name>PDY</name><value><cyclestr>@Y@m@d</cyclestr></value></envar>
		<envar><name>cyc</name><value><cyclestr>@H</cyclestr></value></envar>
		<envar><name>COMROOT</name><value>/scratch3/NCEPDEV/stmp/David.Huber/rt_cleanup/COMROOT</value></envar>
		<envar><name>DATAROOT</name><value>/scratch4/NCEPDEV/stmp/David.Huber/RUNDIRS/C48_ATM/gfs.<cyclestr>@Y@m@d@H</cyclestr></value></envar>
		<envar><name>TARBALL_TYPE</name><value>#tartype#</value></envar>

		<dependency>
			<and>
				<taskdep task="gfs_tracker"/>
				<taskdep task="gfs_genesis"/>
				<metataskdep metatask="gfs_atmos_prod"/>
				<taskdep task="gfs_arch_vrfy"/>
			</and>
		</dependency>

	</task>

</metatask>

<task name="gfs_arch_vrfy" cycledefs="gfs" maxtries="&MAXTRIES;">

	<command>/scratch3/NCEPDEV/global/David.Huber/GW/develop/dev/job_cards/rocoto/arch_vrfy.sh</command>

	<jobname><cyclestr>C48_ATM_gfs_arch_vrfy_@H</cyclestr></jobname>
	<account>fv3-cpu</account>
	<queue>batch</queue>
	<partition>u1-service</partition>
	<walltime>00:30:00</walltime>
	<cores>1</cores>
	<memory>4096M</memory>
	<native>--export=NONE</native>

	<join><cyclestr>/scratch3/NCEPDEV/stmp/David.Huber/rt_cleanup/COMROOT/C48_ATM/logs/@Y@m@d@H/gfs_arch_vrfy.log</cyclestr></join>

	<envar><name>RUN_ENVIR</name><value>emc</value></envar>
	<envar><name>HOMEgfs</name><value>/scratch3/NCEPDEV/global/David.Huber/GW/develop</value></envar>
	<envar><name>EXPDIR</name><value>/scratch3/NCEPDEV/stmp/David.Huber/rt_cleanup/EXPDIR/C48_ATM</value></envar>
	<envar><name>NET</name><value>gfs</value></envar>
	<envar><name>RUN</name><value>gfs</value></envar>
	<envar><name>CDATE</name><value><cyclestr>@Y@m@d@H</cyclestr></value></envar>
	<envar><name>PDY</name><value><cyclestr>@Y@m@d</cyclestr></value></envar>
	<envar><name>cyc</name><value><cyclestr>@H</cyclestr></value></envar>
	<envar><name>COMROOT</name><value>/scratch3/NCEPDEV/stmp/David.Huber/rt_cleanup/COMROOT</value></envar>
	<envar><name>DATAROOT</name><value>/scratch4/NCEPDEV/stmp/David.Huber/RUNDIRS/C48_ATM/gfs.<cyclestr>@Y@m@d@H</cyclestr></value></envar>

	<dependency>
		<and>
			<taskdep task="gfs_tracker"/>
			<taskdep task="gfs_genesis"/>
			<metataskdep metatask="gfs_atmos_prod"/>
		</and>
	</dependency>

</task>

<task name="gfs_cleanup" cycledefs="gfs" maxtries="&MAXTRIES;">

	<command>/scratch3/NCEPDEV/global/David.Huber/GW/develop/dev/job_cards/rocoto/cleanup.sh</command>

	<jobname><cyclestr>C48_ATM_gfs_cleanup_@H</cyclestr></jobname>
	<account>fv3-cpu</account>
	<queue>batch</queue>
	<partition>u1-compute</partition>
	<walltime>00:15:00</walltime>
	<cores>1</cores>
	<memory>4096M</memory>
	<native>--export=NONE</native>

	<join><cyclestr>/scratch3/NCEPDEV/stmp/David.Huber/rt_cleanup/COMROOT/C48_ATM/logs/@Y@m@d@H/gfs_cleanup.log</cyclestr></join>

	<envar><name>RUN_ENVIR</name><value>emc</value></envar>
	<envar><name>HOMEgfs</name><value>/scratch3/NCEPDEV/global/David.Huber/GW/develop</value></envar>
	<envar><name>EXPDIR</name><value>/scratch3/NCEPDEV/stmp/David.Huber/rt_cleanup/EXPDIR/C48_ATM</value></envar>
	<envar><name>NET</name><value>gfs</value></envar>
	<envar><name>RUN</name><value>gfs</value></envar>
	<envar><name>CDATE</name><value><cyclestr>@Y@m@d@H</cyclestr></value></envar>
	<envar><name>PDY</name><value><cyclestr>@Y@m@d</cyclestr></value></envar>
	<envar><name>cyc</name><value><cyclestr>@H</cyclestr></value></envar>
	<envar><name>COMROOT</name><value>/scratch3/NCEPDEV/stmp/David.Huber/rt_cleanup/COMROOT</value></envar>
	<envar><name>DATAROOT</name><value>/scratch4/NCEPDEV/stmp/David.Huber/RUNDIRS/C48_ATM/gfs.<cyclestr>@Y@m@d@H</cyclestr></value></envar>

	<dependency>
		<and>
			<metataskdep metatask="gfs_atmos_prod"/>
			<or>
				<and>
					<taskdep task="gfs_tracker"/>
					<taskdep task="gfs_genesis"/>
					<taskdep task="gfs_arch_vrfy"/>
					<metataskdep metatask="gfs_arch_tars"/>
				</and>
			</or>
		</and>
	</dependency>

</task>

</workflow>
