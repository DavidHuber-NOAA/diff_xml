<?xml version="1.0"?>
<!DOCTYPE workflow
[
	<!--
	PROGRAM
		Main workflow manager for Global Forecast System

	NOTES:
		This workflow was automatically generated at 2025-12-18 09:07:20.564289
	-->
	<!ENTITY PSLOT "C96_atm3DVar">
	<!ENTITY ROTDIR "C96_atm3DVar">
	<!ENTITY MAXTRIES "2">
]>

<workflow realtime="F" scheduler="slurm" cyclethrottle="3" taskthrottle="25">

	<log verbosity="10"><cyclestr>C96_atm3DVar/logs/@Y@m@d@H.log</cyclestr></log>

	<!-- Define the cycles -->
	<cycledef group="gdas_half">202112201800 202112201800 06:00:00</cycledef>
	<cycledef group="gdas">202112210000 202112210600 06:00:00</cycledef>
	<cycledef group="gfs">202112210000 202112210000 24:00:00</cycledef>

<task name="gfs_prep" cycledefs="gfs" maxtries="&MAXTRIES;">

	<command>homegfsdev/job_cards/rocoto/prep.sh</command>

	<jobname><cyclestr>C96_atm3DVar_gfs_prep_@H</cyclestr></jobname>
	<account>drsa-precip3</account>
	<queue>normal</queue>
	<partition>batch</partition>
	<walltime>00:30:00</walltime>
	<cores>14</cores>
	<native>--export=NONE --clusters=c6</native>

	<join><cyclestr>C96_atm3DVar/logs/@Y@m@d@H/gfs_prep.log</cyclestr></join>

	<envar><name>RUN_ENVIR</name><value>emc</value></envar>
	<envar><name>HOMEgfs</name><value>homegfs</value></envar>
	<envar><name>EXPDIR</name><value>C96_atm3DVar</value></envar>
	<envar><name>NET</name><value>gfs</value></envar>
	<envar><name>RUN</name><value>gfs</value></envar>
	<envar><name>CDATE</name><value><cyclestr>@Y@m@d@H</cyclestr></value></envar>
	<envar><name>PDY</name><value><cyclestr>@Y@m@d</cyclestr></value></envar>
	<envar><name>cyc</name><value><cyclestr>@H</cyclestr></value></envar>
	<envar><name>COMROOT</name><value>homegfsdev/workflow/test/COMROOT</value></envar>
	<envar><name>DATAROOT</name><value>/gpfs/f6/drsa-precip3/world-shared/David.Huber/RUNDIRS/C96_atm3DVar/gfs.<cyclestr>@Y@m@d@H</cyclestr></value></envar>

	<dependency>
		<and>
			<metataskdep metatask="gdas_atmos_prod" cycle_offset="-06:00:00"/>
			<datadep><cyclestr offset="-06:00:00">&ROTDIR;/gdas.@Y@m@d/@H//model/atmos/history/gdas.t@Hz.atm.f009.nc</cyclestr></datadep>
			<datadep><cyclestr>/gpfs/f6/drsa-precip3/world-shared/role.glopara/dump/gfs.@Y@m@d/@H/atmos/gfs.t@Hz.updated.status.tm00.bufr_d</cyclestr></datadep>
			<metataskdep metatask="gdas_fcst" cycle_offset="-06:00:00"/>
		</and>
	</dependency>

</task>

<task name="gfs_anal" cycledefs="gfs" maxtries="&MAXTRIES;">

	<command>homegfsdev/job_cards/rocoto/anal.sh</command>

	<jobname><cyclestr>C96_atm3DVar_gfs_anal_@H</cyclestr></jobname>
	<account>drsa-precip3</account>
	<queue>normal</queue>
	<partition>batch</partition>
	<walltime>01:20:00</walltime>
	<nodes>3:ppn=38:tpp=5</nodes>
	<native>--exclusive --clusters=c6</native>

	<join><cyclestr>C96_atm3DVar/logs/@Y@m@d@H/gfs_anal.log</cyclestr></join>

	<envar><name>RUN_ENVIR</name><value>emc</value></envar>
	<envar><name>HOMEgfs</name><value>homegfs</value></envar>
	<envar><name>EXPDIR</name><value>C96_atm3DVar</value></envar>
	<envar><name>NET</name><value>gfs</value></envar>
	<envar><name>RUN</name><value>gfs</value></envar>
	<envar><name>CDATE</name><value><cyclestr>@Y@m@d@H</cyclestr></value></envar>
	<envar><name>PDY</name><value><cyclestr>@Y@m@d</cyclestr></value></envar>
	<envar><name>cyc</name><value><cyclestr>@H</cyclestr></value></envar>
	<envar><name>COMROOT</name><value>homegfsdev/workflow/test/COMROOT</value></envar>
	<envar><name>DATAROOT</name><value>/gpfs/f6/drsa-precip3/world-shared/David.Huber/RUNDIRS/C96_atm3DVar/gfs.<cyclestr>@Y@m@d@H</cyclestr></value></envar>

	<dependency>
		<taskdep task="gfs_prep"/>
	</dependency>

</task>

<task name="gfs_analcalc" cycledefs="gfs" maxtries="&MAXTRIES;">

	<command>homegfsdev/job_cards/rocoto/analcalc.sh</command>

	<jobname><cyclestr>C96_atm3DVar_gfs_analcalc_@H</cyclestr></jobname>
	<account>drsa-precip3</account>
	<queue>normal</queue>
	<partition>batch</partition>
	<walltime>00:15:00</walltime>
	<cores>192</cores>
	<native>--exclusive --clusters=c6</native>

	<join><cyclestr>C96_atm3DVar/logs/@Y@m@d@H/gfs_analcalc.log</cyclestr></join>

	<envar><name>RUN_ENVIR</name><value>emc</value></envar>
	<envar><name>HOMEgfs</name><value>homegfs</value></envar>
	<envar><name>EXPDIR</name><value>C96_atm3DVar</value></envar>
	<envar><name>NET</name><value>gfs</value></envar>
	<envar><name>RUN</name><value>gfs</value></envar>
	<envar><name>CDATE</name><value><cyclestr>@Y@m@d@H</cyclestr></value></envar>
	<envar><name>PDY</name><value><cyclestr>@Y@m@d</cyclestr></value></envar>
	<envar><name>cyc</name><value><cyclestr>@H</cyclestr></value></envar>
	<envar><name>COMROOT</name><value>homegfsdev/workflow/test/COMROOT</value></envar>
	<envar><name>DATAROOT</name><value>/gpfs/f6/drsa-precip3/world-shared/David.Huber/RUNDIRS/C96_atm3DVar/gfs.<cyclestr>@Y@m@d@H</cyclestr></value></envar>

	<dependency>
		<and>
			<taskdep task="gfs_anal"/>
			<taskdep task="gfs_sfcanl"/>
		</and>
	</dependency>

</task>

<task name="gfs_sfcanl" cycledefs="gfs" maxtries="&MAXTRIES;">

	<command>homegfsdev/job_cards/rocoto/sfcanl.sh</command>

	<jobname><cyclestr>C96_atm3DVar_gfs_sfcanl_@H</cyclestr></jobname>
	<account>drsa-precip3</account>
	<queue>normal</queue>
	<partition>batch</partition>
	<walltime>00:20:00</walltime>
	<nodes>1:ppn=48:tpp=4</nodes>
	<native>--exclusive --clusters=c6</native>

	<join><cyclestr>C96_atm3DVar/logs/@Y@m@d@H/gfs_sfcanl.log</cyclestr></join>

	<envar><name>RUN_ENVIR</name><value>emc</value></envar>
	<envar><name>HOMEgfs</name><value>homegfs</value></envar>
	<envar><name>EXPDIR</name><value>C96_atm3DVar</value></envar>
	<envar><name>NET</name><value>gfs</value></envar>
	<envar><name>RUN</name><value>gfs</value></envar>
	<envar><name>CDATE</name><value><cyclestr>@Y@m@d@H</cyclestr></value></envar>
	<envar><name>PDY</name><value><cyclestr>@Y@m@d</cyclestr></value></envar>
	<envar><name>cyc</name><value><cyclestr>@H</cyclestr></value></envar>
	<envar><name>COMROOT</name><value>homegfsdev/workflow/test/COMROOT</value></envar>
	<envar><name>DATAROOT</name><value>/gpfs/f6/drsa-precip3/world-shared/David.Huber/RUNDIRS/C96_atm3DVar/gfs.<cyclestr>@Y@m@d@H</cyclestr></value></envar>

	<dependency>
		<taskdep task="gfs_anal"/>
	</dependency>

</task>

<task name="gfs_atmanlupp" cycledefs="gfs" maxtries="&MAXTRIES;">

	<command>homegfsdev/job_cards/rocoto/upp.sh</command>

	<jobname><cyclestr>C96_atm3DVar_gfs_atmanlupp_@H</cyclestr></jobname>
	<account>drsa-precip3</account>
	<queue>normal</queue>
	<partition>batch</partition>
	<walltime>00:15:00</walltime>
	<cores>96</cores>
	<native>--exclusive --clusters=c6</native>

	<join><cyclestr>C96_atm3DVar/logs/@Y@m@d@H/gfs_atmanlupp.log</cyclestr></join>

	<envar><name>RUN_ENVIR</name><value>emc</value></envar>
	<envar><name>HOMEgfs</name><value>homegfs</value></envar>
	<envar><name>EXPDIR</name><value>C96_atm3DVar</value></envar>
	<envar><name>NET</name><value>gfs</value></envar>
	<envar><name>RUN</name><value>gfs</value></envar>
	<envar><name>CDATE</name><value><cyclestr>@Y@m@d@H</cyclestr></value></envar>
	<envar><name>PDY</name><value><cyclestr>@Y@m@d</cyclestr></value></envar>
	<envar><name>cyc</name><value><cyclestr>@H</cyclestr></value></envar>
	<envar><name>COMROOT</name><value>homegfsdev/workflow/test/COMROOT</value></envar>
	<envar><name>DATAROOT</name><value>/gpfs/f6/drsa-precip3/world-shared/David.Huber/RUNDIRS/C96_atm3DVar/gfs.<cyclestr>@Y@m@d@H</cyclestr></value></envar>
	<envar><name>FHR3</name><value>000</value></envar>
	<envar><name>UPP_RUN</name><value>analysis</value></envar>

	<dependency>
		<and>
			<datadep age="120"><cyclestr>&ROTDIR;/gfs.@Y@m@d/@H//analysis/atmos/gfs.t@Hz.analysis.atm.a006.nc</cyclestr></datadep>
			<datadep age="120"><cyclestr>&ROTDIR;/gfs.@Y@m@d/@H//analysis/atmos/gfs.t@Hz.analysis.sfc.a006.nc</cyclestr></datadep>
			<datadep age="60"><cyclestr>&ROTDIR;/gfs.@Y@m@d/@H//analysis/atmos/gfs.t@Hz.analysis.done.txt</cyclestr></datadep>
		</and>
	</dependency>

</task>

<task name="gfs_atmanlprod" cycledefs="gfs" maxtries="&MAXTRIES;">

	<command>homegfsdev/job_cards/rocoto/atmos_products.sh</command>

	<jobname><cyclestr>C96_atm3DVar_gfs_atmanlprod_@H</cyclestr></jobname>
	<account>drsa-precip3</account>
	<queue>normal</queue>
	<partition>batch</partition>
	<walltime>00:15:00</walltime>
	<cores>24</cores>
	<native>--exclusive --clusters=c6</native>

	<join><cyclestr>C96_atm3DVar/logs/@Y@m@d@H/gfs_atmanlprod.log</cyclestr></join>

	<envar><name>RUN_ENVIR</name><value>emc</value></envar>
	<envar><name>HOMEgfs</name><value>homegfs</value></envar>
	<envar><name>EXPDIR</name><value>C96_atm3DVar</value></envar>
	<envar><name>NET</name><value>gfs</value></envar>
	<envar><name>RUN</name><value>gfs</value></envar>
	<envar><name>CDATE</name><value><cyclestr>@Y@m@d@H</cyclestr></value></envar>
	<envar><name>PDY</name><value><cyclestr>@Y@m@d</cyclestr></value></envar>
	<envar><name>cyc</name><value><cyclestr>@H</cyclestr></value></envar>
	<envar><name>COMROOT</name><value>homegfsdev/workflow/test/COMROOT</value></envar>
	<envar><name>DATAROOT</name><value>/gpfs/f6/drsa-precip3/world-shared/David.Huber/RUNDIRS/C96_atm3DVar/gfs.<cyclestr>@Y@m@d@H</cyclestr></value></envar>
	<envar><name>FHR_LIST</name><value>-1</value></envar>

	<dependency>
		<datadep age="120"><cyclestr>&ROTDIR;/gfs.@Y@m@d/@H//model/atmos/master/gfs.t@Hz.master.analysis.grib2</cyclestr></datadep>
	</dependency>

</task>

<metatask name="gfs_fcst" mode="serial">

	<var name="seg">0</var>

	<task name="gfs_fcst_seg#seg#" cycledefs="gfs" maxtries="&MAXTRIES;">

		<command>homegfsdev/job_cards/rocoto/fcst.sh</command>

		<jobname><cyclestr>C96_atm3DVar_gfs_fcst_seg#seg#_@H</cyclestr></jobname>
		<account>drsa-precip3</account>
		<queue>normal</queue>
		<partition>batch</partition>
		<walltime>03:00:00</walltime>
		<cores>192</cores>
		<native>--exclusive --clusters=c6</native>

		<join><cyclestr>C96_atm3DVar/logs/@Y@m@d@H/gfs_fcst_seg#seg#.log</cyclestr></join>

		<envar><name>RUN_ENVIR</name><value>emc</value></envar>
		<envar><name>HOMEgfs</name><value>homegfs</value></envar>
		<envar><name>EXPDIR</name><value>C96_atm3DVar</value></envar>
		<envar><name>NET</name><value>gfs</value></envar>
		<envar><name>RUN</name><value>gfs</value></envar>
		<envar><name>CDATE</name><value><cyclestr>@Y@m@d@H</cyclestr></value></envar>
		<envar><name>PDY</name><value><cyclestr>@Y@m@d</cyclestr></value></envar>
		<envar><name>cyc</name><value><cyclestr>@H</cyclestr></value></envar>
		<envar><name>COMROOT</name><value>homegfsdev/workflow/test/COMROOT</value></envar>
		<envar><name>DATAROOT</name><value>/gpfs/f6/drsa-precip3/world-shared/David.Huber/RUNDIRS/C96_atm3DVar/gfs.<cyclestr>@Y@m@d@H</cyclestr></value></envar>
		<envar><name>FCST_SEGMENT</name><value>#seg#</value></envar>

		<dependency>
			<or>
				<and>
					<taskdep task="gfs_sfcanl"/>
				</and>
				<and>
					<taskdep task="gfs_stage_ic"/>
					<not><cycleexistdep cycle_offset="-06:00:00"/></not>
				</and>
			</or>
		</dependency>

	</task>

</metatask>

<metatask name="gfs_atmos_prod" mode="parallel">

	<var name="fhr_list">0,1,2 3,4,5 6,7,8 9,10,11 12,13,14 15,16,17 18,19,20 21,22,23 24,25,26 27,28,29 30,31,32 33,34,35 36,37,38 39,40,41 42,43,44 45,46,47 48,51,54 57,60,63 66,69,72 75,78,81 84,87,90 93,96,99 102,105,108 111,114 117,120</var>
	<var name="fhr_label">f000-f002 f003-f005 f006-f008 f009-f011 f012-f014 f015-f017 f018-f020 f021-f023 f024-f026 f027-f029 f030-f032 f033-f035 f036-f038 f039-f041 f042-f044 f045-f047 f048-f054 f057-f063 f066-f072 f075-f081 f084-f090 f093-f099 f102-f108 f111-f114 f117-f120</var>
	<var name="seg_dep">seg0 seg0 seg0 seg0 seg0 seg0 seg0 seg0 seg0 seg0 seg0 seg0 seg0 seg0 seg0 seg0 seg0 seg0 seg0 seg0 seg0 seg0 seg0 seg0 seg0</var>
	<var name="fhr3_last">002 005 008 011 014 017 020 023 026 029 032 035 038 041 044 047 054 063 072 081 090 099 108 114 120</var>
	<var name="fhr3_next">003 006 009 012 015 018 021 024 027 030 033 036 039 042 045 048 057 066 075 084 093 102 111 117 123</var>

	<task name="gfs_atmos_prod_#fhr_label#" cycledefs="gfs" maxtries="&MAXTRIES;">

		<command>homegfsdev/job_cards/rocoto/atmos_products.sh</command>

		<jobname><cyclestr>C96_atm3DVar_gfs_atmos_prod_#fhr_label#_@H</cyclestr></jobname>
		<account>drsa-precip3</account>
		<queue>normal</queue>
		<partition>batch</partition>
		<walltime>00:45:00</walltime>
		<cores>24</cores>
		<native>--exclusive --clusters=c6</native>

		<join><cyclestr>C96_atm3DVar/logs/@Y@m@d@H/gfs_atmos_prod_#fhr_label#.log</cyclestr></join>

		<envar><name>RUN_ENVIR</name><value>emc</value></envar>
		<envar><name>HOMEgfs</name><value>homegfs</value></envar>
		<envar><name>EXPDIR</name><value>C96_atm3DVar</value></envar>
		<envar><name>NET</name><value>gfs</value></envar>
		<envar><name>RUN</name><value>gfs</value></envar>
		<envar><name>CDATE</name><value><cyclestr>@Y@m@d@H</cyclestr></value></envar>
		<envar><name>PDY</name><value><cyclestr>@Y@m@d</cyclestr></value></envar>
		<envar><name>cyc</name><value><cyclestr>@H</cyclestr></value></envar>
		<envar><name>COMROOT</name><value>homegfsdev/workflow/test/COMROOT</value></envar>
		<envar><name>DATAROOT</name><value>/gpfs/f6/drsa-precip3/world-shared/David.Huber/RUNDIRS/C96_atm3DVar/gfs.<cyclestr>@Y@m@d@H</cyclestr></value></envar>
		<envar><name>FHR_LIST</name><value>#fhr_list#</value></envar>
		<envar><name>COMPONENT</name><value>atmos</value></envar>

		<dependency>
			<or>
				<datadep age="120"><cyclestr>&ROTDIR;/gfs.@Y@m@d/@H//model/atmos/master/gfs.t@Hz.master.f#fhr3_last#.grib2</cyclestr></datadep>
				<metataskdep metatask="gfs_fcst"/>
			</or>
		</dependency>

	</task>

</metatask>

<task name="gfs_vminmon" cycledefs="gfs" maxtries="&MAXTRIES;">

	<command>homegfsdev/job_cards/rocoto/vminmon.sh</command>

	<jobname><cyclestr>C96_atm3DVar_gfs_vminmon_@H</cyclestr></jobname>
	<account>drsa-precip3</account>
	<queue>normal</queue>
	<partition>batch</partition>
	<walltime>00:05:00</walltime>
	<cores>1</cores>
	<native>--export=NONE --clusters=c6</native>

	<join><cyclestr>C96_atm3DVar/logs/@Y@m@d@H/gfs_vminmon.log</cyclestr></join>

	<envar><name>RUN_ENVIR</name><value>emc</value></envar>
	<envar><name>HOMEgfs</name><value>homegfs</value></envar>
	<envar><name>EXPDIR</name><value>C96_atm3DVar</value></envar>
	<envar><name>NET</name><value>gfs</value></envar>
	<envar><name>RUN</name><value>gfs</value></envar>
	<envar><name>CDATE</name><value><cyclestr>@Y@m@d@H</cyclestr></value></envar>
	<envar><name>PDY</name><value><cyclestr>@Y@m@d</cyclestr></value></envar>
	<envar><name>cyc</name><value><cyclestr>@H</cyclestr></value></envar>
	<envar><name>COMROOT</name><value>homegfsdev/workflow/test/COMROOT</value></envar>
	<envar><name>DATAROOT</name><value>/gpfs/f6/drsa-precip3/world-shared/David.Huber/RUNDIRS/C96_atm3DVar/gfs.<cyclestr>@Y@m@d@H</cyclestr></value></envar>

	<dependency>
		<taskdep task="gfs_anal"/>
	</dependency>

</task>

<task name="gfs_tracker" cycledefs="gfs" maxtries="&MAXTRIES;">

	<command>homegfsdev/job_cards/rocoto/tracker.sh</command>

	<jobname><cyclestr>C96_atm3DVar_gfs_tracker_@H</cyclestr></jobname>
	<account>drsa-precip3</account>
	<queue>normal</queue>
	<partition>batch</partition>
	<walltime>00:10:00</walltime>
	<cores>1</cores>
	<native>--export=NONE --clusters=c6</native>

	<join><cyclestr>C96_atm3DVar/logs/@Y@m@d@H/gfs_tracker.log</cyclestr></join>

	<envar><name>RUN_ENVIR</name><value>emc</value></envar>
	<envar><name>HOMEgfs</name><value>homegfs</value></envar>
	<envar><name>EXPDIR</name><value>C96_atm3DVar</value></envar>
	<envar><name>NET</name><value>gfs</value></envar>
	<envar><name>RUN</name><value>gfs</value></envar>
	<envar><name>CDATE</name><value><cyclestr>@Y@m@d@H</cyclestr></value></envar>
	<envar><name>PDY</name><value><cyclestr>@Y@m@d</cyclestr></value></envar>
	<envar><name>cyc</name><value><cyclestr>@H</cyclestr></value></envar>
	<envar><name>COMROOT</name><value>homegfsdev/workflow/test/COMROOT</value></envar>
	<envar><name>DATAROOT</name><value>/gpfs/f6/drsa-precip3/world-shared/David.Huber/RUNDIRS/C96_atm3DVar/gfs.<cyclestr>@Y@m@d@H</cyclestr></value></envar>

	<dependency>
		<metataskdep metatask="gfs_atmos_prod"/>
	</dependency>

</task>

<task name="gfs_genesis" cycledefs="gfs" maxtries="&MAXTRIES;">

	<command>homegfsdev/job_cards/rocoto/genesis.sh</command>

	<jobname><cyclestr>C96_atm3DVar_gfs_genesis_@H</cyclestr></jobname>
	<account>drsa-precip3</account>
	<queue>normal</queue>
	<partition>batch</partition>
	<walltime>00:40:00</walltime>
	<cores>1</cores>
	<native>--export=NONE --clusters=c6</native>

	<join><cyclestr>C96_atm3DVar/logs/@Y@m@d@H/gfs_genesis.log</cyclestr></join>

	<envar><name>RUN_ENVIR</name><value>emc</value></envar>
	<envar><name>HOMEgfs</name><value>homegfs</value></envar>
	<envar><name>EXPDIR</name><value>C96_atm3DVar</value></envar>
	<envar><name>NET</name><value>gfs</value></envar>
	<envar><name>RUN</name><value>gfs</value></envar>
	<envar><name>CDATE</name><value><cyclestr>@Y@m@d@H</cyclestr></value></envar>
	<envar><name>PDY</name><value><cyclestr>@Y@m@d</cyclestr></value></envar>
	<envar><name>cyc</name><value><cyclestr>@H</cyclestr></value></envar>
	<envar><name>COMROOT</name><value>homegfsdev/workflow/test/COMROOT</value></envar>
	<envar><name>DATAROOT</name><value>/gpfs/f6/drsa-precip3/world-shared/David.Huber/RUNDIRS/C96_atm3DVar/gfs.<cyclestr>@Y@m@d@H</cyclestr></value></envar>

	<dependency>
		<metataskdep metatask="gfs_atmos_prod"/>
	</dependency>

</task>

<task name="gfs_arch_vrfy" cycledefs="gfs" maxtries="&MAXTRIES;">

	<command>homegfsdev/job_cards/rocoto/arch_vrfy.sh</command>

	<jobname><cyclestr>C96_atm3DVar_gfs_arch_vrfy_@H</cyclestr></jobname>
	<account>drsa-precip3</account>
	<queue>normal</queue>
	<partition>batch</partition>
	<walltime>00:30:00</walltime>
	<cores>1</cores>
	<native>--export=NONE --clusters=c6</native>

	<join><cyclestr>C96_atm3DVar/logs/@Y@m@d@H/gfs_arch_vrfy.log</cyclestr></join>

	<envar><name>RUN_ENVIR</name><value>emc</value></envar>
	<envar><name>HOMEgfs</name><value>homegfs</value></envar>
	<envar><name>EXPDIR</name><value>C96_atm3DVar</value></envar>
	<envar><name>NET</name><value>gfs</value></envar>
	<envar><name>RUN</name><value>gfs</value></envar>
	<envar><name>CDATE</name><value><cyclestr>@Y@m@d@H</cyclestr></value></envar>
	<envar><name>PDY</name><value><cyclestr>@Y@m@d</cyclestr></value></envar>
	<envar><name>cyc</name><value><cyclestr>@H</cyclestr></value></envar>
	<envar><name>COMROOT</name><value>homegfsdev/workflow/test/COMROOT</value></envar>
	<envar><name>DATAROOT</name><value>/gpfs/f6/drsa-precip3/world-shared/David.Huber/RUNDIRS/C96_atm3DVar/gfs.<cyclestr>@Y@m@d@H</cyclestr></value></envar>

	<dependency>
		<and>
			<taskdep task="gfs_atmanlprod"/>
			<taskdep task="gfs_tracker"/>
			<taskdep task="gfs_genesis"/>
			<metataskdep metatask="gfs_atmos_prod"/>
		</and>
	</dependency>

</task>

<metatask name="gfs_arch_tars" mode="parallel">

	<var name="tartype">gfsa gfsb gfs_flux gfs_netcdfb gfs_pgrb2b gfs_netcdfa gfs_restarta</var>

	<task name="gfs_arch_tar_#tartype#" cycledefs="gfs" maxtries="&MAXTRIES;">

		<command>homegfsdev/job_cards/rocoto/arch_tars.sh</command>

		<jobname><cyclestr>C96_atm3DVar_gfs_arch_tar_#tartype#_@H</cyclestr></jobname>
		<account>drsa-precip3</account>
		<queue>hpss</queue>
		<partition>dtn_f5_f6</partition>
		<walltime>06:00:00</walltime>
		<cores>1</cores>
		<native>--export=NONE --clusters=es</native>

		<join><cyclestr>C96_atm3DVar/logs/@Y@m@d@H/gfs_arch_tar_#tartype#.log</cyclestr></join>

		<envar><name>RUN_ENVIR</name><value>emc</value></envar>
		<envar><name>HOMEgfs</name><value>homegfs</value></envar>
		<envar><name>EXPDIR</name><value>C96_atm3DVar</value></envar>
		<envar><name>NET</name><value>gfs</value></envar>
		<envar><name>RUN</name><value>gfs</value></envar>
		<envar><name>CDATE</name><value><cyclestr>@Y@m@d@H</cyclestr></value></envar>
		<envar><name>PDY</name><value><cyclestr>@Y@m@d</cyclestr></value></envar>
		<envar><name>cyc</name><value><cyclestr>@H</cyclestr></value></envar>
		<envar><name>COMROOT</name><value>homegfsdev/workflow/test/COMROOT</value></envar>
		<envar><name>DATAROOT</name><value>/gpfs/f6/drsa-precip3/world-shared/David.Huber/RUNDIRS/C96_atm3DVar/gfs.<cyclestr>@Y@m@d@H</cyclestr></value></envar>
		<envar><name>TARBALL_TYPE</name><value>#tartype#</value></envar>

		<dependency>
			<and>
				<taskdep task="gfs_atmanlprod"/>
				<taskdep task="gfs_vminmon"/>
				<taskdep task="gfs_tracker"/>
				<taskdep task="gfs_genesis"/>
				<metataskdep metatask="gfs_atmos_prod"/>
				<taskdep task="gfs_arch_vrfy"/>
			</and>
		</dependency>

	</task>

</metatask>

<task name="gfs_cleanup" cycledefs="gfs" maxtries="&MAXTRIES;">

	<command>homegfsdev/job_cards/rocoto/cleanup.sh</command>

	<jobname><cyclestr>C96_atm3DVar_gfs_cleanup_@H</cyclestr></jobname>
	<account>drsa-precip3</account>
	<queue>normal</queue>
	<partition>batch</partition>
	<walltime>00:15:00</walltime>
	<cores>1</cores>
	<native>--export=NONE --clusters=c6</native>

	<join><cyclestr>C96_atm3DVar/logs/@Y@m@d@H/gfs_cleanup.log</cyclestr></join>

	<envar><name>RUN_ENVIR</name><value>emc</value></envar>
	<envar><name>HOMEgfs</name><value>homegfs</value></envar>
	<envar><name>EXPDIR</name><value>C96_atm3DVar</value></envar>
	<envar><name>NET</name><value>gfs</value></envar>
	<envar><name>RUN</name><value>gfs</value></envar>
	<envar><name>CDATE</name><value><cyclestr>@Y@m@d@H</cyclestr></value></envar>
	<envar><name>PDY</name><value><cyclestr>@Y@m@d</cyclestr></value></envar>
	<envar><name>cyc</name><value><cyclestr>@H</cyclestr></value></envar>
	<envar><name>COMROOT</name><value>homegfsdev/workflow/test/COMROOT</value></envar>
	<envar><name>DATAROOT</name><value>/gpfs/f6/drsa-precip3/world-shared/David.Huber/RUNDIRS/C96_atm3DVar/gfs.<cyclestr>@Y@m@d@H</cyclestr></value></envar>

	<dependency>
		<and>
			<metataskdep metatask="gfs_atmos_prod"/>
			<taskdep task="gfs_atmanlprod"/>
			<taskdep task="gfs_vminmon"/>
			<taskdep task="gfs_tracker"/>
			<taskdep task="gfs_genesis"/>
			<taskdep task="gfs_arch_vrfy"/>
			<metataskdep metatask="gfs_arch_tars"/>
		</and>
	</dependency>

</task>

<task name="gdas_prep" cycledefs="gdas" maxtries="&MAXTRIES;">

	<command>homegfsdev/job_cards/rocoto/prep.sh</command>

	<jobname><cyclestr>C96_atm3DVar_gdas_prep_@H</cyclestr></jobname>
	<account>drsa-precip3</account>
	<queue>normal</queue>
	<partition>batch</partition>
	<walltime>00:30:00</walltime>
	<cores>14</cores>
	<native>--export=NONE --clusters=c6</native>

	<join><cyclestr>C96_atm3DVar/logs/@Y@m@d@H/gdas_prep.log</cyclestr></join>

	<envar><name>RUN_ENVIR</name><value>emc</value></envar>
	<envar><name>HOMEgfs</name><value>homegfs</value></envar>
	<envar><name>EXPDIR</name><value>C96_atm3DVar</value></envar>
	<envar><name>NET</name><value>gfs</value></envar>
	<envar><name>RUN</name><value>gdas</value></envar>
	<envar><name>CDATE</name><value><cyclestr>@Y@m@d@H</cyclestr></value></envar>
	<envar><name>PDY</name><value><cyclestr>@Y@m@d</cyclestr></value></envar>
	<envar><name>cyc</name><value><cyclestr>@H</cyclestr></value></envar>
	<envar><name>COMROOT</name><value>homegfsdev/workflow/test/COMROOT</value></envar>
	<envar><name>DATAROOT</name><value>/gpfs/f6/drsa-precip3/world-shared/David.Huber/RUNDIRS/C96_atm3DVar/gdas.<cyclestr>@Y@m@d@H</cyclestr></value></envar>

	<dependency>
		<and>
			<metataskdep metatask="gdas_atmos_prod" cycle_offset="-06:00:00"/>
			<datadep><cyclestr offset="-06:00:00">&ROTDIR;/gdas.@Y@m@d/@H//model/atmos/history/gdas.t@Hz.atm.f009.nc</cyclestr></datadep>
			<datadep><cyclestr>/gpfs/f6/drsa-precip3/world-shared/role.glopara/dump/gdas.@Y@m@d/@H/atmos/gdas.t@Hz.updated.status.tm00.bufr_d</cyclestr></datadep>
			<metataskdep metatask="gdas_fcst" cycle_offset="-06:00:00"/>
		</and>
	</dependency>

</task>

<task name="gdas_anal" cycledefs="gdas" maxtries="&MAXTRIES;">

	<command>homegfsdev/job_cards/rocoto/anal.sh</command>

	<jobname><cyclestr>C96_atm3DVar_gdas_anal_@H</cyclestr></jobname>
	<account>drsa-precip3</account>
	<queue>normal</queue>
	<partition>batch</partition>
	<walltime>01:20:00</walltime>
	<nodes>3:ppn=38:tpp=5</nodes>
	<native>--exclusive --clusters=c6</native>

	<join><cyclestr>C96_atm3DVar/logs/@Y@m@d@H/gdas_anal.log</cyclestr></join>

	<envar><name>RUN_ENVIR</name><value>emc</value></envar>
	<envar><name>HOMEgfs</name><value>homegfs</value></envar>
	<envar><name>EXPDIR</name><value>C96_atm3DVar</value></envar>
	<envar><name>NET</name><value>gfs</value></envar>
	<envar><name>RUN</name><value>gdas</value></envar>
	<envar><name>CDATE</name><value><cyclestr>@Y@m@d@H</cyclestr></value></envar>
	<envar><name>PDY</name><value><cyclestr>@Y@m@d</cyclestr></value></envar>
	<envar><name>cyc</name><value><cyclestr>@H</cyclestr></value></envar>
	<envar><name>COMROOT</name><value>homegfsdev/workflow/test/COMROOT</value></envar>
	<envar><name>DATAROOT</name><value>/gpfs/f6/drsa-precip3/world-shared/David.Huber/RUNDIRS/C96_atm3DVar/gdas.<cyclestr>@Y@m@d@H</cyclestr></value></envar>

	<dependency>
		<taskdep task="gdas_prep"/>
	</dependency>

</task>

<task name="gdas_analcalc" cycledefs="gdas" maxtries="&MAXTRIES;">

	<command>homegfsdev/job_cards/rocoto/analcalc.sh</command>

	<jobname><cyclestr>C96_atm3DVar_gdas_analcalc_@H</cyclestr></jobname>
	<account>drsa-precip3</account>
	<queue>normal</queue>
	<partition>batch</partition>
	<walltime>00:15:00</walltime>
	<cores>192</cores>
	<native>--exclusive --clusters=c6</native>

	<join><cyclestr>C96_atm3DVar/logs/@Y@m@d@H/gdas_analcalc.log</cyclestr></join>

	<envar><name>RUN_ENVIR</name><value>emc</value></envar>
	<envar><name>HOMEgfs</name><value>homegfs</value></envar>
	<envar><name>EXPDIR</name><value>C96_atm3DVar</value></envar>
	<envar><name>NET</name><value>gfs</value></envar>
	<envar><name>RUN</name><value>gdas</value></envar>
	<envar><name>CDATE</name><value><cyclestr>@Y@m@d@H</cyclestr></value></envar>
	<envar><name>PDY</name><value><cyclestr>@Y@m@d</cyclestr></value></envar>
	<envar><name>cyc</name><value><cyclestr>@H</cyclestr></value></envar>
	<envar><name>COMROOT</name><value>homegfsdev/workflow/test/COMROOT</value></envar>
	<envar><name>DATAROOT</name><value>/gpfs/f6/drsa-precip3/world-shared/David.Huber/RUNDIRS/C96_atm3DVar/gdas.<cyclestr>@Y@m@d@H</cyclestr></value></envar>

	<dependency>
		<and>
			<taskdep task="gdas_anal"/>
			<taskdep task="gdas_sfcanl"/>
		</and>
	</dependency>

</task>

<task name="gdas_sfcanl" cycledefs="gdas" maxtries="&MAXTRIES;">

	<command>homegfsdev/job_cards/rocoto/sfcanl.sh</command>

	<jobname><cyclestr>C96_atm3DVar_gdas_sfcanl_@H</cyclestr></jobname>
	<account>drsa-precip3</account>
	<queue>normal</queue>
	<partition>batch</partition>
	<walltime>00:20:00</walltime>
	<nodes>1:ppn=48:tpp=4</nodes>
	<native>--exclusive --clusters=c6</native>

	<join><cyclestr>C96_atm3DVar/logs/@Y@m@d@H/gdas_sfcanl.log</cyclestr></join>

	<envar><name>RUN_ENVIR</name><value>emc</value></envar>
	<envar><name>HOMEgfs</name><value>homegfs</value></envar>
	<envar><name>EXPDIR</name><value>C96_atm3DVar</value></envar>
	<envar><name>NET</name><value>gfs</value></envar>
	<envar><name>RUN</name><value>gdas</value></envar>
	<envar><name>CDATE</name><value><cyclestr>@Y@m@d@H</cyclestr></value></envar>
	<envar><name>PDY</name><value><cyclestr>@Y@m@d</cyclestr></value></envar>
	<envar><name>cyc</name><value><cyclestr>@H</cyclestr></value></envar>
	<envar><name>COMROOT</name><value>homegfsdev/workflow/test/COMROOT</value></envar>
	<envar><name>DATAROOT</name><value>/gpfs/f6/drsa-precip3/world-shared/David.Huber/RUNDIRS/C96_atm3DVar/gdas.<cyclestr>@Y@m@d@H</cyclestr></value></envar>

	<dependency>
		<taskdep task="gdas_anal"/>
	</dependency>

</task>

<task name="gdas_analdiag" cycledefs="gdas" maxtries="&MAXTRIES;">

	<command>homegfsdev/job_cards/rocoto/analdiag.sh</command>

	<jobname><cyclestr>C96_atm3DVar_gdas_analdiag_@H</cyclestr></jobname>
	<account>drsa-precip3</account>
	<queue>normal</queue>
	<partition>batch</partition>
	<walltime>00:15:00</walltime>
	<cores>192</cores>
	<native>--export=NONE --clusters=c6</native>

	<join><cyclestr>C96_atm3DVar/logs/@Y@m@d@H/gdas_analdiag.log</cyclestr></join>

	<envar><name>RUN_ENVIR</name><value>emc</value></envar>
	<envar><name>HOMEgfs</name><value>homegfs</value></envar>
	<envar><name>EXPDIR</name><value>C96_atm3DVar</value></envar>
	<envar><name>NET</name><value>gfs</value></envar>
	<envar><name>RUN</name><value>gdas</value></envar>
	<envar><name>CDATE</name><value><cyclestr>@Y@m@d@H</cyclestr></value></envar>
	<envar><name>PDY</name><value><cyclestr>@Y@m@d</cyclestr></value></envar>
	<envar><name>cyc</name><value><cyclestr>@H</cyclestr></value></envar>
	<envar><name>COMROOT</name><value>homegfsdev/workflow/test/COMROOT</value></envar>
	<envar><name>DATAROOT</name><value>/gpfs/f6/drsa-precip3/world-shared/David.Huber/RUNDIRS/C96_atm3DVar/gdas.<cyclestr>@Y@m@d@H</cyclestr></value></envar>

	<dependency>
		<and>
			<taskdep task="gdas_anal"/>
		</and>
	</dependency>

</task>

<task name="gdas_stage_ic" cycledefs="gdas_half" maxtries="&MAXTRIES;">

	<command>homegfsdev/job_cards/rocoto/stage_ic.sh</command>

	<jobname><cyclestr>C96_atm3DVar_gdas_stage_ic_@H</cyclestr></jobname>
	<account>drsa-precip3</account>
	<queue>normal</queue>
	<partition>batch</partition>
	<walltime>00:15:00</walltime>
	<cores>1</cores>
	<native>--export=NONE --clusters=c6</native>

	<join><cyclestr>C96_atm3DVar/logs/@Y@m@d@H/gdas_stage_ic.log</cyclestr></join>

	<envar><name>RUN_ENVIR</name><value>emc</value></envar>
	<envar><name>HOMEgfs</name><value>homegfs</value></envar>
	<envar><name>EXPDIR</name><value>C96_atm3DVar</value></envar>
	<envar><name>NET</name><value>gfs</value></envar>
	<envar><name>RUN</name><value>gdas</value></envar>
	<envar><name>CDATE</name><value><cyclestr>@Y@m@d@H</cyclestr></value></envar>
	<envar><name>PDY</name><value><cyclestr>@Y@m@d</cyclestr></value></envar>
	<envar><name>cyc</name><value><cyclestr>@H</cyclestr></value></envar>
	<envar><name>COMROOT</name><value>homegfsdev/workflow/test/COMROOT</value></envar>
	<envar><name>DATAROOT</name><value>/gpfs/f6/drsa-precip3/world-shared/David.Huber/RUNDIRS/C96_atm3DVar/gdas.<cyclestr>@Y@m@d@H</cyclestr></value></envar>

</task>

<task name="gdas_atmanlupp" cycledefs="gdas" maxtries="&MAXTRIES;">

	<command>homegfsdev/job_cards/rocoto/upp.sh</command>

	<jobname><cyclestr>C96_atm3DVar_gdas_atmanlupp_@H</cyclestr></jobname>
	<account>drsa-precip3</account>
	<queue>normal</queue>
	<partition>batch</partition>
	<walltime>00:15:00</walltime>
	<cores>96</cores>
	<native>--exclusive --clusters=c6</native>

	<join><cyclestr>C96_atm3DVar/logs/@Y@m@d@H/gdas_atmanlupp.log</cyclestr></join>

	<envar><name>RUN_ENVIR</name><value>emc</value></envar>
	<envar><name>HOMEgfs</name><value>homegfs</value></envar>
	<envar><name>EXPDIR</name><value>C96_atm3DVar</value></envar>
	<envar><name>NET</name><value>gfs</value></envar>
	<envar><name>RUN</name><value>gdas</value></envar>
	<envar><name>CDATE</name><value><cyclestr>@Y@m@d@H</cyclestr></value></envar>
	<envar><name>PDY</name><value><cyclestr>@Y@m@d</cyclestr></value></envar>
	<envar><name>cyc</name><value><cyclestr>@H</cyclestr></value></envar>
	<envar><name>COMROOT</name><value>homegfsdev/workflow/test/COMROOT</value></envar>
	<envar><name>DATAROOT</name><value>/gpfs/f6/drsa-precip3/world-shared/David.Huber/RUNDIRS/C96_atm3DVar/gdas.<cyclestr>@Y@m@d@H</cyclestr></value></envar>
	<envar><name>FHR3</name><value>000</value></envar>
	<envar><name>UPP_RUN</name><value>analysis</value></envar>

	<dependency>
		<and>
			<datadep age="120"><cyclestr>&ROTDIR;/gdas.@Y@m@d/@H//analysis/atmos/gdas.t@Hz.analysis.atm.a006.nc</cyclestr></datadep>
			<datadep age="120"><cyclestr>&ROTDIR;/gdas.@Y@m@d/@H//analysis/atmos/gdas.t@Hz.analysis.sfc.a006.nc</cyclestr></datadep>
			<datadep age="60"><cyclestr>&ROTDIR;/gdas.@Y@m@d/@H//analysis/atmos/gdas.t@Hz.analysis.done.txt</cyclestr></datadep>
		</and>
	</dependency>

</task>

<task name="gdas_atmanlprod" cycledefs="gdas" maxtries="&MAXTRIES;">

	<command>homegfsdev/job_cards/rocoto/atmos_products.sh</command>

	<jobname><cyclestr>C96_atm3DVar_gdas_atmanlprod_@H</cyclestr></jobname>
	<account>drsa-precip3</account>
	<queue>normal</queue>
	<partition>batch</partition>
	<walltime>00:15:00</walltime>
	<cores>24</cores>
	<native>--exclusive --clusters=c6</native>

	<join><cyclestr>C96_atm3DVar/logs/@Y@m@d@H/gdas_atmanlprod.log</cyclestr></join>

	<envar><name>RUN_ENVIR</name><value>emc</value></envar>
	<envar><name>HOMEgfs</name><value>homegfs</value></envar>
	<envar><name>EXPDIR</name><value>C96_atm3DVar</value></envar>
	<envar><name>NET</name><value>gfs</value></envar>
	<envar><name>RUN</name><value>gdas</value></envar>
	<envar><name>CDATE</name><value><cyclestr>@Y@m@d@H</cyclestr></value></envar>
	<envar><name>PDY</name><value><cyclestr>@Y@m@d</cyclestr></value></envar>
	<envar><name>cyc</name><value><cyclestr>@H</cyclestr></value></envar>
	<envar><name>COMROOT</name><value>homegfsdev/workflow/test/COMROOT</value></envar>
	<envar><name>DATAROOT</name><value>/gpfs/f6/drsa-precip3/world-shared/David.Huber/RUNDIRS/C96_atm3DVar/gdas.<cyclestr>@Y@m@d@H</cyclestr></value></envar>
	<envar><name>FHR_LIST</name><value>-1</value></envar>

	<dependency>
		<datadep age="120"><cyclestr>&ROTDIR;/gdas.@Y@m@d/@H//model/atmos/master/gdas.t@Hz.master.analysis.grib2</cyclestr></datadep>
	</dependency>

</task>

<metatask name="gdas_fcst" mode="serial">

	<var name="seg">0</var>

	<task name="gdas_fcst_seg#seg#" cycledefs="gdas_half,gdas" maxtries="&MAXTRIES;">

		<command>homegfsdev/job_cards/rocoto/fcst.sh</command>

		<jobname><cyclestr>C96_atm3DVar_gdas_fcst_seg#seg#_@H</cyclestr></jobname>
		<account>drsa-precip3</account>
		<queue>normal</queue>
		<partition>batch</partition>
		<walltime>00:20:00</walltime>
		<cores>192</cores>
		<native>--exclusive --clusters=c6</native>

		<join><cyclestr>C96_atm3DVar/logs/@Y@m@d@H/gdas_fcst_seg#seg#.log</cyclestr></join>

		<envar><name>RUN_ENVIR</name><value>emc</value></envar>
		<envar><name>HOMEgfs</name><value>homegfs</value></envar>
		<envar><name>EXPDIR</name><value>C96_atm3DVar</value></envar>
		<envar><name>NET</name><value>gfs</value></envar>
		<envar><name>RUN</name><value>gdas</value></envar>
		<envar><name>CDATE</name><value><cyclestr>@Y@m@d@H</cyclestr></value></envar>
		<envar><name>PDY</name><value><cyclestr>@Y@m@d</cyclestr></value></envar>
		<envar><name>cyc</name><value><cyclestr>@H</cyclestr></value></envar>
		<envar><name>COMROOT</name><value>homegfsdev/workflow/test/COMROOT</value></envar>
		<envar><name>DATAROOT</name><value>/gpfs/f6/drsa-precip3/world-shared/David.Huber/RUNDIRS/C96_atm3DVar/gdas.<cyclestr>@Y@m@d@H</cyclestr></value></envar>
		<envar><name>FCST_SEGMENT</name><value>#seg#</value></envar>

		<dependency>
			<or>
				<and>
					<taskdep task="gdas_sfcanl"/>
				</and>
				<and>
					<taskdep task="gdas_stage_ic"/>
					<not><cycleexistdep cycle_offset="-06:00:00"/></not>
				</and>
			</or>
		</dependency>

	</task>

</metatask>

<metatask name="gdas_atmos_prod" mode="parallel">

	<var name="fhr_list">0 3 6 9</var>
	<var name="fhr_label">f000 f003 f006 f009</var>
	<var name="seg_dep">seg0 seg0 seg0 seg0</var>
	<var name="fhr3_last">000 003 006 009</var>
	<var name="fhr3_next">003 006 009 012</var>

	<task name="gdas_atmos_prod_#fhr_label#" cycledefs="gdas_half,gdas" maxtries="&MAXTRIES;">

		<command>homegfsdev/job_cards/rocoto/atmos_products.sh</command>

		<jobname><cyclestr>C96_atm3DVar_gdas_atmos_prod_#fhr_label#_@H</cyclestr></jobname>
		<account>drsa-precip3</account>
		<queue>normal</queue>
		<partition>batch</partition>
		<walltime>00:15:00</walltime>
		<cores>24</cores>
		<native>--exclusive --clusters=c6</native>

		<join><cyclestr>C96_atm3DVar/logs/@Y@m@d@H/gdas_atmos_prod_#fhr_label#.log</cyclestr></join>

		<envar><name>RUN_ENVIR</name><value>emc</value></envar>
		<envar><name>HOMEgfs</name><value>homegfs</value></envar>
		<envar><name>EXPDIR</name><value>C96_atm3DVar</value></envar>
		<envar><name>NET</name><value>gfs</value></envar>
		<envar><name>RUN</name><value>gdas</value></envar>
		<envar><name>CDATE</name><value><cyclestr>@Y@m@d@H</cyclestr></value></envar>
		<envar><name>PDY</name><value><cyclestr>@Y@m@d</cyclestr></value></envar>
		<envar><name>cyc</name><value><cyclestr>@H</cyclestr></value></envar>
		<envar><name>COMROOT</name><value>homegfsdev/workflow/test/COMROOT</value></envar>
		<envar><name>DATAROOT</name><value>/gpfs/f6/drsa-precip3/world-shared/David.Huber/RUNDIRS/C96_atm3DVar/gdas.<cyclestr>@Y@m@d@H</cyclestr></value></envar>
		<envar><name>FHR_LIST</name><value>#fhr_list#</value></envar>
		<envar><name>COMPONENT</name><value>atmos</value></envar>

		<dependency>
			<or>
				<datadep age="120"><cyclestr>&ROTDIR;/gdas.@Y@m@d/@H//model/atmos/master/gdas.t@Hz.master.f#fhr3_last#.grib2</cyclestr></datadep>
				<metataskdep metatask="gdas_fcst"/>
			</or>
		</dependency>

	</task>

</metatask>

<task name="gdas_fit2obs" cycledefs="gdas" maxtries="&MAXTRIES;">

	<command>homegfsdev/job_cards/rocoto/fit2obs.sh</command>

	<jobname><cyclestr>C96_atm3DVar_gdas_fit2obs_@H</cyclestr></jobname>
	<account>drsa-precip3</account>
	<queue>normal</queue>
	<partition>batch</partition>
	<walltime>00:20:00</walltime>
	<nodes>3:ppn=1:tpp=1</nodes>
	<native>--export=NONE --clusters=c6</native>

	<join><cyclestr>C96_atm3DVar/logs/@Y@m@d@H/gdas_fit2obs.log</cyclestr></join>

	<envar><name>RUN_ENVIR</name><value>emc</value></envar>
	<envar><name>HOMEgfs</name><value>homegfs</value></envar>
	<envar><name>EXPDIR</name><value>C96_atm3DVar</value></envar>
	<envar><name>NET</name><value>gfs</value></envar>
	<envar><name>RUN</name><value>gdas</value></envar>
	<envar><name>CDATE</name><value><cyclestr>@Y@m@d@H</cyclestr></value></envar>
	<envar><name>PDY</name><value><cyclestr>@Y@m@d</cyclestr></value></envar>
	<envar><name>cyc</name><value><cyclestr>@H</cyclestr></value></envar>
	<envar><name>COMROOT</name><value>homegfsdev/workflow/test/COMROOT</value></envar>
	<envar><name>DATAROOT</name><value>/gpfs/f6/drsa-precip3/world-shared/David.Huber/RUNDIRS/C96_atm3DVar/gdas.<cyclestr>@Y@m@d@H</cyclestr></value></envar>

	<dependency>
		<metataskdep metatask="gdas_atmos_prod"/>
	</dependency>

</task>

<task name="gdas_verfozn" cycledefs="gdas" maxtries="&MAXTRIES;">

	<command>homegfsdev/job_cards/rocoto/verfozn.sh</command>

	<jobname><cyclestr>C96_atm3DVar_gdas_verfozn_@H</cyclestr></jobname>
	<account>drsa-precip3</account>
	<queue>normal</queue>
	<partition>batch</partition>
	<walltime>00:10:00</walltime>
	<cores>1</cores>
	<native>--export=NONE --clusters=c6</native>

	<join><cyclestr>C96_atm3DVar/logs/@Y@m@d@H/gdas_verfozn.log</cyclestr></join>

	<envar><name>RUN_ENVIR</name><value>emc</value></envar>
	<envar><name>HOMEgfs</name><value>homegfs</value></envar>
	<envar><name>EXPDIR</name><value>C96_atm3DVar</value></envar>
	<envar><name>NET</name><value>gfs</value></envar>
	<envar><name>RUN</name><value>gdas</value></envar>
	<envar><name>CDATE</name><value><cyclestr>@Y@m@d@H</cyclestr></value></envar>
	<envar><name>PDY</name><value><cyclestr>@Y@m@d</cyclestr></value></envar>
	<envar><name>cyc</name><value><cyclestr>@H</cyclestr></value></envar>
	<envar><name>COMROOT</name><value>homegfsdev/workflow/test/COMROOT</value></envar>
	<envar><name>DATAROOT</name><value>/gpfs/f6/drsa-precip3/world-shared/David.Huber/RUNDIRS/C96_atm3DVar/gdas.<cyclestr>@Y@m@d@H</cyclestr></value></envar>

	<dependency>
		<taskdep task="gdas_analdiag"/>
	</dependency>

</task>

<task name="gdas_verfrad" cycledefs="gdas" maxtries="&MAXTRIES;">

	<command>homegfsdev/job_cards/rocoto/verfrad.sh</command>

	<jobname><cyclestr>C96_atm3DVar_gdas_verfrad_@H</cyclestr></jobname>
	<account>drsa-precip3</account>
	<queue>normal</queue>
	<partition>batch</partition>
	<walltime>00:40:00</walltime>
	<cores>1</cores>
	<native>--export=NONE --clusters=c6</native>

	<join><cyclestr>C96_atm3DVar/logs/@Y@m@d@H/gdas_verfrad.log</cyclestr></join>

	<envar><name>RUN_ENVIR</name><value>emc</value></envar>
	<envar><name>HOMEgfs</name><value>homegfs</value></envar>
	<envar><name>EXPDIR</name><value>C96_atm3DVar</value></envar>
	<envar><name>NET</name><value>gfs</value></envar>
	<envar><name>RUN</name><value>gdas</value></envar>
	<envar><name>CDATE</name><value><cyclestr>@Y@m@d@H</cyclestr></value></envar>
	<envar><name>PDY</name><value><cyclestr>@Y@m@d</cyclestr></value></envar>
	<envar><name>cyc</name><value><cyclestr>@H</cyclestr></value></envar>
	<envar><name>COMROOT</name><value>homegfsdev/workflow/test/COMROOT</value></envar>
	<envar><name>DATAROOT</name><value>/gpfs/f6/drsa-precip3/world-shared/David.Huber/RUNDIRS/C96_atm3DVar/gdas.<cyclestr>@Y@m@d@H</cyclestr></value></envar>

	<dependency>
		<taskdep task="gdas_analdiag"/>
	</dependency>

</task>

<task name="gdas_anlstat" cycledefs="gdas" maxtries="&MAXTRIES;">

	<command>homegfsdev/job_cards/rocoto/anlstat.sh</command>

	<jobname><cyclestr>C96_atm3DVar_gdas_anlstat_@H</cyclestr></jobname>
	<account>drsa-precip3</account>
	<queue>normal</queue>
	<partition>batch</partition>
	<walltime>00:30:00</walltime>
	<cores>20</cores>
	<native>--export=NONE --clusters=c6</native>

	<join><cyclestr>C96_atm3DVar/logs/@Y@m@d@H/gdas_anlstat.log</cyclestr></join>

	<envar><name>RUN_ENVIR</name><value>emc</value></envar>
	<envar><name>HOMEgfs</name><value>homegfs</value></envar>
	<envar><name>EXPDIR</name><value>C96_atm3DVar</value></envar>
	<envar><name>NET</name><value>gfs</value></envar>
	<envar><name>RUN</name><value>gdas</value></envar>
	<envar><name>CDATE</name><value><cyclestr>@Y@m@d@H</cyclestr></value></envar>
	<envar><name>PDY</name><value><cyclestr>@Y@m@d</cyclestr></value></envar>
	<envar><name>cyc</name><value><cyclestr>@H</cyclestr></value></envar>
	<envar><name>COMROOT</name><value>homegfsdev/workflow/test/COMROOT</value></envar>
	<envar><name>DATAROOT</name><value>/gpfs/f6/drsa-precip3/world-shared/David.Huber/RUNDIRS/C96_atm3DVar/gdas.<cyclestr>@Y@m@d@H</cyclestr></value></envar>

	<dependency>
		<and>
			<taskdep task="gdas_analdiag"/>
		</and>
	</dependency>

</task>

<task name="gdas_vminmon" cycledefs="gdas" maxtries="&MAXTRIES;">

	<command>homegfsdev/job_cards/rocoto/vminmon.sh</command>

	<jobname><cyclestr>C96_atm3DVar_gdas_vminmon_@H</cyclestr></jobname>
	<account>drsa-precip3</account>
	<queue>normal</queue>
	<partition>batch</partition>
	<walltime>00:05:00</walltime>
	<cores>1</cores>
	<native>--export=NONE --clusters=c6</native>

	<join><cyclestr>C96_atm3DVar/logs/@Y@m@d@H/gdas_vminmon.log</cyclestr></join>

	<envar><name>RUN_ENVIR</name><value>emc</value></envar>
	<envar><name>HOMEgfs</name><value>homegfs</value></envar>
	<envar><name>EXPDIR</name><value>C96_atm3DVar</value></envar>
	<envar><name>NET</name><value>gfs</value></envar>
	<envar><name>RUN</name><value>gdas</value></envar>
	<envar><name>CDATE</name><value><cyclestr>@Y@m@d@H</cyclestr></value></envar>
	<envar><name>PDY</name><value><cyclestr>@Y@m@d</cyclestr></value></envar>
	<envar><name>cyc</name><value><cyclestr>@H</cyclestr></value></envar>
	<envar><name>COMROOT</name><value>homegfsdev/workflow/test/COMROOT</value></envar>
	<envar><name>DATAROOT</name><value>/gpfs/f6/drsa-precip3/world-shared/David.Huber/RUNDIRS/C96_atm3DVar/gdas.<cyclestr>@Y@m@d@H</cyclestr></value></envar>

	<dependency>
		<taskdep task="gdas_anal"/>
	</dependency>

</task>

<task name="gdas_arch_vrfy" cycledefs="gdas" maxtries="&MAXTRIES;">

	<command>homegfsdev/job_cards/rocoto/arch_vrfy.sh</command>

	<jobname><cyclestr>C96_atm3DVar_gdas_arch_vrfy_@H</cyclestr></jobname>
	<account>drsa-precip3</account>
	<queue>normal</queue>
	<partition>batch</partition>
	<walltime>00:30:00</walltime>
	<cores>1</cores>
	<native>--export=NONE --clusters=c6</native>

	<join><cyclestr>C96_atm3DVar/logs/@Y@m@d@H/gdas_arch_vrfy.log</cyclestr></join>

	<envar><name>RUN_ENVIR</name><value>emc</value></envar>
	<envar><name>HOMEgfs</name><value>homegfs</value></envar>
	<envar><name>EXPDIR</name><value>C96_atm3DVar</value></envar>
	<envar><name>NET</name><value>gfs</value></envar>
	<envar><name>RUN</name><value>gdas</value></envar>
	<envar><name>CDATE</name><value><cyclestr>@Y@m@d@H</cyclestr></value></envar>
	<envar><name>PDY</name><value><cyclestr>@Y@m@d</cyclestr></value></envar>
	<envar><name>cyc</name><value><cyclestr>@H</cyclestr></value></envar>
	<envar><name>COMROOT</name><value>homegfsdev/workflow/test/COMROOT</value></envar>
	<envar><name>DATAROOT</name><value>/gpfs/f6/drsa-precip3/world-shared/David.Huber/RUNDIRS/C96_atm3DVar/gdas.<cyclestr>@Y@m@d@H</cyclestr></value></envar>

	<dependency>
		<and>
			<taskdep task="gdas_atmanlprod"/>
			<taskdep task="gdas_fit2obs"/>
			<metataskdep metatask="gdas_atmos_prod"/>
		</and>
	</dependency>

</task>

<metatask name="gdas_arch_tars" mode="parallel">

	<var name="tartype">gdas gdas_restarta gdas_restartb</var>

	<task name="gdas_arch_tar_#tartype#" cycledefs="gdas" maxtries="&MAXTRIES;">

		<command>homegfsdev/job_cards/rocoto/arch_tars.sh</command>

		<jobname><cyclestr>C96_atm3DVar_gdas_arch_tar_#tartype#_@H</cyclestr></jobname>
		<account>drsa-precip3</account>
		<queue>hpss</queue>
		<partition>dtn_f5_f6</partition>
		<walltime>06:00:00</walltime>
		<cores>1</cores>
		<native>--export=NONE --clusters=es</native>

		<join><cyclestr>C96_atm3DVar/logs/@Y@m@d@H/gdas_arch_tar_#tartype#.log</cyclestr></join>

		<envar><name>RUN_ENVIR</name><value>emc</value></envar>
		<envar><name>HOMEgfs</name><value>homegfs</value></envar>
		<envar><name>EXPDIR</name><value>C96_atm3DVar</value></envar>
		<envar><name>NET</name><value>gfs</value></envar>
		<envar><name>RUN</name><value>gdas</value></envar>
		<envar><name>CDATE</name><value><cyclestr>@Y@m@d@H</cyclestr></value></envar>
		<envar><name>PDY</name><value><cyclestr>@Y@m@d</cyclestr></value></envar>
		<envar><name>cyc</name><value><cyclestr>@H</cyclestr></value></envar>
		<envar><name>COMROOT</name><value>homegfsdev/workflow/test/COMROOT</value></envar>
		<envar><name>DATAROOT</name><value>/gpfs/f6/drsa-precip3/world-shared/David.Huber/RUNDIRS/C96_atm3DVar/gdas.<cyclestr>@Y@m@d@H</cyclestr></value></envar>
		<envar><name>TARBALL_TYPE</name><value>#tartype#</value></envar>

		<dependency>
			<and>
				<taskdep task="gdas_atmanlprod"/>
				<taskdep task="gdas_fit2obs"/>
				<taskdep task="gdas_verfozn"/>
				<taskdep task="gdas_verfrad"/>
				<taskdep task="gdas_vminmon"/>
				<taskdep task="gdas_anlstat"/>
				<metataskdep metatask="gdas_atmos_prod"/>
				<taskdep task="gdas_arch_vrfy"/>
			</and>
		</dependency>

	</task>

</metatask>

<task name="gdas_cleanup" cycledefs="gdas_half, gdas" maxtries="&MAXTRIES;">

	<command>homegfsdev/job_cards/rocoto/cleanup.sh</command>

	<jobname><cyclestr>C96_atm3DVar_gdas_cleanup_@H</cyclestr></jobname>
	<account>drsa-precip3</account>
	<queue>normal</queue>
	<partition>batch</partition>
	<walltime>00:15:00</walltime>
	<cores>1</cores>
	<native>--export=NONE --clusters=c6</native>

	<join><cyclestr>C96_atm3DVar/logs/@Y@m@d@H/gdas_cleanup.log</cyclestr></join>

	<envar><name>RUN_ENVIR</name><value>emc</value></envar>
	<envar><name>HOMEgfs</name><value>homegfs</value></envar>
	<envar><name>EXPDIR</name><value>C96_atm3DVar</value></envar>
	<envar><name>NET</name><value>gfs</value></envar>
	<envar><name>RUN</name><value>gdas</value></envar>
	<envar><name>CDATE</name><value><cyclestr>@Y@m@d@H</cyclestr></value></envar>
	<envar><name>PDY</name><value><cyclestr>@Y@m@d</cyclestr></value></envar>
	<envar><name>cyc</name><value><cyclestr>@H</cyclestr></value></envar>
	<envar><name>COMROOT</name><value>homegfsdev/workflow/test/COMROOT</value></envar>
	<envar><name>DATAROOT</name><value>/gpfs/f6/drsa-precip3/world-shared/David.Huber/RUNDIRS/C96_atm3DVar/gdas.<cyclestr>@Y@m@d@H</cyclestr></value></envar>

	<dependency>
		<and>
			<or>
				<taskdep task="gfs_fcst_seg0" cycle_offset="24:00:00"/>
				<not><cycleexistdep cycle_offset="24:00:00"/></not>
			</or>
			<metataskdep metatask="gdas_atmos_prod"/>
			<or>
				<streq><left><cyclestr>@Y@m@d@H</cyclestr></left><right>2021122018</right></streq>
				<and>
					<taskdep task="gdas_atmanlprod"/>
					<taskdep task="gdas_fit2obs"/>
					<taskdep task="gdas_verfozn"/>
					<taskdep task="gdas_verfrad"/>
					<taskdep task="gdas_vminmon"/>
					<taskdep task="gdas_arch_vrfy"/>
					<metataskdep metatask="gdas_arch_tars"/>
				</and>
			</or>
		</and>
	</dependency>

</task>

</workflow>
